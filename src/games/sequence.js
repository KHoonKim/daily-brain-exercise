// ===== 5. SEQUENCE - 순서 기억 =====
let seqLv,seqSeq,seqIdx,seqShowing,seqScore;
function initSequence(){seqLv=1;seqScore=0;document.getElementById('seq-score').textContent='0점';document.getElementById('seq-level').textContent='Lv.1';initHearts('seq');const g=document.getElementById('seq-grid');g.innerHTML='';for(let i=1;i<=9;i++){const d=document.createElement('div');d.className='seq-cell';d.textContent=i;d.dataset.n=i;d.onclick=()=>seqTap(i);g.appendChild(d)}seqNewRound()}
function seqNewRound(){seqShowing=true;seqIdx=0;const len=seqLv+2;seqSeq=[];while(seqSeq.length<len){const n=~~(Math.random()*9)+1;if(seqSeq[seqSeq.length-1]!==n)seqSeq.push(n)}document.getElementById('seq-msg').textContent='순서를 기억하세요!';let i=0;const iv=setInterval(()=>{document.querySelectorAll('.seq-cell').forEach(c=>c.classList.remove('hl'));if(i<seqSeq.length){document.querySelector(`.seq-cell[data-n="${seqSeq[i]}"]`).classList.add('hl');i++}else{clearInterval(iv);document.querySelectorAll('.seq-cell').forEach(c=>c.classList.remove('hl'));seqShowing=false;document.getElementById('seq-msg').textContent='같은 순서로 눌러주세요!'}},600)}
function seqTap(n){if(seqShowing)return;const c=document.querySelector(`.seq-cell[data-n="${n}"]`);if(n===seqSeq[seqIdx]){c.classList.add('ok');setTimeout(()=>c.classList.remove('ok'),300);seqScore+=10;setScore('seq-score',seqScore);seqIdx++;if(seqIdx===seqSeq.length){seqLv++;document.getElementById('seq-level').textContent='Lv.'+seqLv;scheduleNextQuestion(seqNewRound,500)}}else{curScore=seqScore;setHeartResumeCallback(seqNewRound);if(loseHeart('seq'))return;const cells=document.querySelectorAll('.seq-cell');cells.forEach(c=>c.classList.add('wrong'));document.getElementById('seq-msg').textContent='틀렸어요! 다시 시작!';setTimeout(()=>cells.forEach(c=>c.classList.remove('wrong')),600);scheduleNextQuestion(seqNewRound,800)}}
